<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A repository for my thoughts"><link rel="shortcut icon" href=https://www.hailelagi.com/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>Database Internals: B Tree Basics - Concepts</title></head><body><header id=banner><h2><a href=https://www.hailelagi.com/>Haile (ሐይሌ)</a></h2><nav><ul><li><a href=/bookshelf title=bookshelf>bookshelf</a></li><li><a href=https://www.github.com/hailelagi title=github>github</a></li><li><a href=/notes title=notes>notes</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Database Internals: B Tree Basics - Concepts</h1><time>February 27, 2024</time></header><p>⚠️⚠️ WIP: Early Draft ⚠️⚠️</p><p>What is a Datastructure: everything is either a contigous block or pointer based.
search techniques: binary search - Olog(N) is powerful.</p><p>why is it called a B-Tree? According to one of the co-inventor&rsquo;s <a href=https://vimeo.com/73357851>Edward M. McCreight it&rsquo;s short for &ldquo;balance&rdquo;</a>.</p><h2 id=things-to-not-think-about---yet>Things to <em>NOT</em> think about - (yet)</h2><ul><li>Memory allocation: garbage collection and language choice</li><li>The pitfalls of memory: fragmentation & corruption</li><li>pre-mature optimisation (serialisation, network calls etc)</li><li>scope creep (adding fancy concurrency mechanisms - MVCC)</li><li>pre-mature horizontal distribution (sharding, replication, unreliable network and the headaches of distributed systems etc)</li><li>2-3-Tree, LSM Trees, variants etc.</li></ul><p>Onto the How?</p><h2 id=implementation-high-level-ideas>Implementation high level ideas</h2><ul><li>Performance (Access Patterns - everything is about access patterns)</li><li>Correctness & Testing</li><li>Durability (what&rsquo;s a block?, brief overview: buffered IO, mmap, directIO.)</li></ul><p>performance big ideas overview:</p><ul><li>why do we want search trees? balancing and order</li><li>going beyond Big-O</li><li>immutability vs immutability</li><li>concurrency</li><li>locality of reference (keep stuff close togther)</li></ul><h2 id=tools-of-the-trade>Tools of the Trade</h2><ul><li>a good debugger (dbg, etc)</li><li>flamegraphs</li><li>tests</li></ul><h2 id=b-trees>B Trees</h2><p>desired properties:</p><ul><li>high fanout (dense trees)</li><li>short height</li></ul><p><strong>Operations Overview</strong>:</p><ul><li>insertion</li><li>access</li><li>deletions</li></ul><p>Performance comes from thinking wholistically about hardware and software together.
Optimizations bear the fruits of pretty benchmarks and complexity.
The first big piece is concurrency and parallelism.</p><p>tldr; the hard part about building storage engines is debugging and testing them, old databases are good because time spent in production uncovering (or not uncovering bugs).</p><p>In the real world stuff goes wrong(the operating system hides hardware and software faults, but you have to care), data loss is bad and is a big no-no.</p><h3 id=correctness-testing--safety>Correctness, Testing & Safety</h3><p>Complexity is <strong>evil</strong> but unavoidable, non-determinism makes you helpless.</p><p>testing methodology, loom - concurrency is hard etc:</p><ul><li>How SQLlite is tested: <a href=https://www.sqlite.org/testing.html>https://www.sqlite.org/testing.html</a></li><li>Valgrind, Address and Memory Sanitizer</li><li><a href=https://www.cs.utexas.edu/~bornholt/papers/shardstore-sosp21.pdf>https://www.cs.utexas.edu/~bornholt/papers/shardstore-sosp21.pdf</a></li><li><a href=https://github.com/tigerbeetle/tigerbeetle/blob/main/docs/DESIGN.md#safety>https://github.com/tigerbeetle/tigerbeetle/blob/main/docs/DESIGN.md#safety</a></li><li><a href=https://apple.github.io/foundationdb/testing.html>https://apple.github.io/foundationdb/testing.html</a></li><li>many more&mldr;</li></ul><h2 id=storage-engine-architecture>Storage Engine Architecture</h2><p>Move towards modularization of database components, decoupled query & execution engine(velox, datafusion etc), storage engine see: <a href=https://apple.github.io/foundationdb/layer-concept.html>foundationDB</a>.</p><p>What the heck is going on in your favorite database? select popular deep dives into
popular storage engines for: postgres/postgres, kubernetes/etcd, mysql/InnoDB, mongodb(WiredTiger):</p><p>postgres:
<a href=https://postgrespro.com/blog/pgsql/4161516>https://postgrespro.com/blog/pgsql/4161516</a></p><p>etcd: <a href=https://etcd.io/docs/v3.5/learning/data_model/>https://etcd.io/docs/v3.5/learning/data_model/</a></p><p>innodb: <a href=https://dev.mysql.com/doc/refman/8.0/en/innodb-physical-structure.html>https://dev.mysql.com/doc/refman/8.0/en/innodb-physical-structure.html</a></p><p>mongodb: <a href=https://source.wiredtiger.com/11.2.0/arch-btree.html>https://source.wiredtiger.com/11.2.0/arch-btree.html</a></p></article></main><footer id=footer><a href=https://github.com/hailelagi/blog>source</a>
Copyright © 2024 Haile Lagi<div id=sign-key><span>GPG key ID: 0298F4203ADC85E8</span></div></footer></body></html>